<?php

/**
 * @var Nether\Surface\Engine $Surface
 */

?>

<div id="LoginForm" class="row justify-content-center">
	<div class="col-12 col-md-6">
		<h4>Log In</h4>
		<p>Enter your login credentials.</p>
		<form method="post">
			<div class="row justify-content-center">
				<div class="col-12 mb-2">
					<input id="LoginUsername" type="text" class="form-control" name="Username" placeholder="Username..." />
				</div>
				<div class="col-12 mb-2">
					<input id="LoginPassword" type="text" class="form-control" name="Password" placeholder="Password..." />
				</div>
				<div class="col-12">
					<button id="LoginAccept" type="submit" class="btn btn-primary d-block w-100">Log In</button>
				</div>
			</div>
		</form>
	</div>
</div>

<script type="module">
import JsonRequest from '/share/atlantis/api/json-request.js?v=<?php $Printer($CacheBuster) ?>';

jQuery(function(){

	jQuery('#LoginForm form')
	.on('submit', function() {

		let input = jQuery(this).serializeArray();
		let data = new FormData;
		let req = new JsonRequest('POST', '/api/user/session/login', data);

		for(const item of input)
		data.set(item.name, item.value);

		(req.send())
		.then(function(result) {
			console.log(result);

			if(result.error !== 0) {
				alert(result.message);
				return;
			}

			location.href = '/';
			return;
		});

		return false;
	});

	return;
});
</script>
