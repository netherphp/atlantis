<?php

// phpcs:disable

use Nether\Atlantis;
use Nether\Avenue;
use Nether\Blog;
use Nether\Common;
use Nether\Surface;
use Nether\User;

/**
 * @var Atlantis\Engine $App
 * @var Atlantis\Struct\TemplateHelper $Util
 * @var Avenue\Router $Router
 * @var Surface\Engine $Surface
 * @var User\EntitySession $User
 *
 * @var Atlantis\PublicWeb $Route
 * @var Blog\BlogUser $BlogUser
 * @var Blog\Blog $Blog
 * @var Blog\Post $Post
 */

?>

<?php $Surface->Area('blog/blog-header', $__SCOPE) ?>

<hr id="BlogPostInfo"
    class="d-none"
    data-blog-id="<?php $Util->Print($Post->BlogID) ?>"
    data-post-id="<?php $Util->Print($Post->ID) ?>"
    data-post-uuid="<?php $Util->Print($Post->UUID) ?>"
    />

<div class="pt-4 pb-4">
	<div class="container">

		<div class="row">
			<div class="col-12 col-md-8 mb-4 mb-md-0">

				<h2><?php $Printer($Post->Title) ?></h2>
				<hr class="opacity-20" />

				<div class="letter-space-reading">
				<?php

				if($Post->Editor === 'editorjs') {
					$Content = Common\Struct\EditorJS\Content::FromString($Post->Content);

					$Content->Blocks->Each(
						fn(Common\Struct\EditorJS\Block $Block)
						=> print($Block)
					);
				}

				elseif($Post->Editor === 'link')
				$Surface->Area('blog/views/link', $__SCOPE);

				else
				$Surface->Area('blog/views/html', $__SCOPE);

				?>
				</div>

			</div>
			<div class="col-12 col-md-4 mb-4 mb-md-0">

				<?php if($BlogUser): ?>
				<!-- SIDEBAR: MANAGE -->
				<div class="quotron hr-hide-last mb-6">
					<?php if($BlogUser->CanWrite()): ?>
					<a href="<?php $Printer($Post->GetEditURL()) ?>" class="btn btn-outline-light btn-block text-align-left">
						<i class="mdi mdi-fw mdi-pencil"></i>
						Edit
					</a>
					<hr class="mt-2 mb-2" />

					<a href="#" class="btn btn-outline-light btn-block text-align-left CmdPostEditTags">
						<i class="mdi mdi-fw mdi-tag"></i>
						Manage Tags
					</a>
					<hr class="mt-2 mb-2" />
					<?php endif; ?>
				</div>
				<?php endif; ?>

			</div>
		</div>

	</div>
</div>

<?php if($BlogUser->CanEdit()): ?>
<script type="module">
import TagDialog from '/share/atlantis/tag-dialog.js';

jQuery(function() {

	let info = jQuery('#BlogPostInfo');
	let blog = { id: info.attr('data-blog-id') };
	let post = { id: info.attr('data-post-id'), uuid: info.attr('data-post-uuid') };

	jQuery('.CmdPostEditTags')
	.on('click', function(){

		let diag = new TagDialog(post.uuid, 'blogpost');
		diag.show();

		return false;
	});

	return;
});
</script>
<?php endif; ?>
